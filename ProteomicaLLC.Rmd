---
title: "ProteomicaLLC"
author: "Covadonga Rodríguez Suárez"
date: "2025-03-11"
output: html_document
---

```{r, message=FALSE, warning=FALSE}
library(DESeq2)
library(ggplot2)
library(readxl)
```

```{r}
proteomicaLLC <- read_excel("320_Final_report_MouseCelllines_v2.xlsx")
```

```{r}
# 1. Define your exact plotting order
desired_order <- c(
  "LP1","LP2","LP3","LP4",       # Parental
  "LCTC1","LCTC2","LCTC3","LCTC4",# CTC
  "LB1","LB2","LB3","LB4",       # Brain
  "LL1","LL2","LL3","LL4"        # Limb
)

# 2. Subset & reorder the matrix
mat <- as.matrix(proteomicaLLC[, desired_order])
rownames(mat) <- proteomicaLLC$Gene

# 3. Build your new human-readable labels
new_labels <- c(
  LP1    = "LLC-Parental#1",   LP2    = "LLC-Parental#2",
  LP3    = "LLC-Parental#3",   LP4    = "LLC-Parental#4",
  LCTC1  = "LLC-CTC#1",        LCTC2  = "LLC-CTC#2",
  LCTC3  = "LLC-CTC#3",        LCTC4  = "LLC-CTC#4",
  LB1    = "LLC-Brain#1",      LB2    = "LLC-Brain#2",
  LB3    = "LLC-Brain#3",      LB4    = "LLC-Brain#4",
  LL1    = "LLC-Limb#1",       LL2    = "LLC-Limb#2",
  LL3    = "LLC-Limb#3",       LL4    = "LLC-Limb#4"
)

# 4. Apply those labels to the columns
colnames(mat) <- new_labels[colnames(mat)]

# 5. Choose your color ramp
my_colors <- colorRampPalette(c("green","black","red"))(100)

# 6. Draw the heatmap, preserving your order but showing the tree
pheatmap(
  mat,
  scale                    = "row",
  clustering_distance_rows = "euclidean",
  clustering_distance_cols = "euclidean",
  clustering_method        = "complete",
  cluster_cols             = TRUE,  
  treeheight_col           = 20,     
  show_rownames            = FALSE,
  show_colnames            = TRUE,
  color                    = my_colors
)
```
```{r}
pheatmap(
  mat,
  scale = "row",
  clustering_distance_rows = "euclidean",
  clustering_distance_cols = "euclidean",
  clustering_method = "complete",
  show_rownames = FALSE,
  show_colnames = TRUE,
  cluster_cols = FALSE,     
  color = my_colors
)
```


```{r}
# Load libraries
library(ggplot2)
library(ggrepel)  # for geom_label_repel

# 1) Assign your columns to simpler names for convenience
proteomicaLLC$log2FC        <- proteomicaLLC$`Log2 FoldChange CTC_PARENTAL`
proteomicaLLC$negLog10pval  <- proteomicaLLC$`-Log p-value CTC_PARENTAL`
proteomicaLLC$pval          <- proteomicaLLC$`p-value CTC_PARENTAL`  
proteomicaLLC$Gene          <- proteomicaLLC$Gene                     #gene/protein identifier column

# 2) Define a “Significance” column based on log2FC and p-value
proteomicaLLC$Significance <- "Not Sig"
proteomicaLLC$Significance[proteomicaLLC$log2FC >= 0.38  & proteomicaLLC$pval < 0.05] <- "Up"
proteomicaLLC$Significance[proteomicaLLC$log2FC <= -0.38 & proteomicaLLC$pval < 0.05] <- "Down"

# 3) Make the volcano plot
p_CTC <- ggplot(proteomicaLLC, aes(x = log2FC, y = negLog10pval, color = Significance)) +
  geom_point(alpha = 0.8, size = 2) +
  scale_color_manual(
    values = c("Down" = "#377EB8", "Not Sig" = "grey70", "Up" = "firebrick")
  ) +
  labs(
    title = "LLC: CTC vs. Parental",
    x = expression(log[2]~fold~change),
    y = expression(-log[10]~pvalue)
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title       = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank(),
    legend.title     = element_blank()
  )

# 4) Add dashed lines for log2FC=±1 and p=0.05 
p_CTC <- p_CTC +
  geom_vline(xintercept = c(-0.38, 0.38), color = "blue", linetype = "dashed") +
  geom_hline(yintercept = -log10(0.05), color = "blue", linetype = "dashed")

# 5) Label the top 20 most significant genes
topGenes <- subset(proteomicaLLC, pval < 0.05 & abs(log2FC) > 2)
topGenes <- topGenes[order(topGenes$pval), ] 
topGenes20 <- head(topGenes, 20)

p_CTC <- p_CTC +
  geom_label_repel(
    data = topGenes20,
    aes(label = Gene),
    size = 3,
    color = "black",
    fill = "white",
    box.padding  = 0.65,
    point.padding = 0.3,
    force = 8,
    max.overlaps = Inf,
    segment.color = "black"
  )

# 6) Print final plot
print(p_CTC)
```


```{r}
library(ggplot2)
library(ggrepel)

# 1) Assign your MET BRAIN_PARENTAL columns to simpler names
proteomicaLLC$log2FC_MET_BRAIN  <- proteomicaLLC$`Log2 FoldChange MET BRAIN_PARENTAL`
proteomicaLLC$negLogP_MET_BRAIN <- proteomicaLLC$`-Log p-value MET BRAIN_PARENTAL`
proteomicaLLC$pval_MET_BRAIN    <- proteomicaLLC$`p-value MET BRAIN_PARENTAL`
proteomicaLLC$Gene           <- proteomicaLLC$Gene  # Gene/protein identifier

# 2) Define “Significance” based on log2FC and p-value 
proteomicaLLC$Significance_MET_BRAIN <- "Not Sig"
proteomicaLLC$Significance_MET_BRAIN[
  proteomicaLLC$log2FC_MET_BRAIN >= 0.38 & proteomicaLLC$pval_MET_BRAIN < 0.05
] <- "Up"
proteomicaLLC$Significance_MET_BRAIN[
  proteomicaLLC$log2FC_MET_BRAIN <= -0.38 & proteomicaLLC$pval_MET_BRAIN < 0.05
] <- "Down"

# 3) Build the volcano plot
p_MET_BRAIN <- ggplot(
  proteomicaLLC,
  aes(x = log2FC_MET_BRAIN, y = negLogP_MET_BRAIN, color = Significance_MET_BRAIN)
) +
  geom_point(alpha = 0.8, size = 2) +
  scale_color_manual(
    values = c("Down" = "#377EB8", "Not Sig" = "grey70", "Up" = "firebrick")
  ) +
  labs(
    title = "LLC: Brain vs. Parental",
    x = expression(log[2]~fold~change),
    y = expression(-log[10]~pvalue)
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title       = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank(),
    legend.title     = element_blank()
  )

# 4) Add dashed lines for log2FC=±0.38 and p=0.05 
p_MET_BRAIN <- p_MET_BRAIN +
  geom_vline(xintercept = c(-0.38, 0.38), color = "blue", linetype = "dashed") +
  geom_hline(yintercept = -log10(0.05),   color = "blue", linetype = "dashed")

# 5) Label the top 20 most significant genes
topGenes_MET_BRAIN <- subset(proteomicaLLC, pval_MET_BRAIN < 0.05 & abs(log2FC_MET_BRAIN) > 2)
topGenes_MET_BRAIN <- topGenes_MET_BRAIN[order(topGenes_MET_BRAIN$pval_MET_BRAIN), ]  
topGenes20_MET_BRAIN <- head(topGenes_MET_BRAIN, 20)

p_MET_BRAIN <- p_MET_BRAIN +
  geom_label_repel(
    data = topGenes20_MET_BRAIN,
    aes(label = Gene),
    size = 3,
    color = "black",
    fill = "white",
    box.padding  = 0.65,
    point.padding = 0.3,
    force = 8,
    max.overlaps = Inf,
    segment.color = "black"
  )

# 6) Print final plot
print(p_MET_BRAIN)
```

```{r}
library(ggplot2)
library(ggrepel)

# 1) Assign your MET LIMB_PARENTAL columns to simpler names
proteomicaLLC$log2FC_LIMB   <- proteomicaLLC$`Log2 FoldChange MET LIMB_PARENTAL`
proteomicaLLC$negLogP_LIMB  <- proteomicaLLC$`-Log p-value MET LIMB_PARENTAL`
proteomicaLLC$pval_LIMB     <- proteomicaLLC$`p-value MET LIMB_PARENTAL`
proteomicaLLC$Gene          <- proteomicaLLC$Gene  # Gene/protein names

# 2) Define “Significance” based on log2FC and p-value (±0.38 cutoff, p < 0.05)
proteomicaLLC$Significance_LIMB <- "Not Sig"
proteomicaLLC$Significance_LIMB[
  proteomicaLLC$log2FC_LIMB >= 0.38 & proteomicaLLC$pval_LIMB < 0.05
] <- "Up"
proteomicaLLC$Significance_LIMB[
  proteomicaLLC$log2FC_LIMB <= -0.38 & proteomicaLLC$pval_LIMB < 0.05
] <- "Down"

# 3) Build the volcano plot
p_LIMB <- ggplot(
  proteomicaLLC,
  aes(x = log2FC_LIMB, y = negLogP_LIMB, color = Significance_LIMB)
) +
  geom_point(alpha = 0.8, size = 2) +
  scale_color_manual(
    values = c("Down" = "#377EB8", "Not Sig" = "grey70", "Up" = "firebrick")
  ) +
  labs(
    title = "LLC: Bone vs. Parental",
    x = expression(log[2]~fold~change),
    y = expression(-log[10]~pvalue)
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title       = element_text(face = "bold", hjust = 0.5),
    panel.grid.minor = element_blank(),
    legend.title     = element_blank()
  )

# 4) Add dashed lines for log2FC=±0.38 and p=0.05 
p_LIMB <- p_LIMB +
  geom_vline(xintercept = c(-0.38, 0.38), color = "blue", linetype = "dashed") +
  geom_hline(yintercept = -log10(0.05),   color = "blue", linetype = "dashed")

# 5) Label the top 20 most significant genes
topGenes_LIMB <- subset(proteomicaLLC, pval_LIMB < 0.05 & abs(log2FC_LIMB) > 2)
topGenes_LIMB <- topGenes_LIMB[order(topGenes_LIMB$pval_LIMB), ]
topGenes20_LIMB <- head(topGenes_LIMB, 20)

p_LIMB <- p_LIMB +
  geom_label_repel(
    data = topGenes20_LIMB,
    aes(label = Gene),
    size = 3,
    color = "black",
    fill = "white",
    box.padding  = 0.65,
    point.padding = 0.3,
    force = 8,
    max.overlaps = Inf,
    segment.color = "black"
  )

# 6) Print the final plot
print(p_LIMB)
```

